<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Standard Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" name="viewport" />

    <title>SFPM Login Page</title>
    <meta name="description" content="TKMS Login Page" />
    
    <link href="semantic/dist/semantic.min.css" rel="stylesheet" />
    <link href="plugins/pacejs/pace.css" rel="stylesheet" />
    <link href="plugins/lobibox/css/lobibox.css" rel="stylesheet" />
    <link href="css/main.css" rel="stylesheet" />
    <link href="img/favicon.ico" rel="shortcut icon" />
	<link href="css/my_style.css" rel="stylesheet" />
    
	<style type="text/css">
	body {
		background: url(img/bg01.png) no-repeat center;
		background-size: 100%;
	}
	</style>
</head>
<body>
    <img src="img/text.png" style="float: right;width: 40%;height: 13%;padding-top: 2%;padding-right: 2%;">
    <div class="ui container" style="padding-top:10%">
        <div class="ui grid center aligned">
            <div class="row">
                <div class="sixteen wide tablet six wide computer column">
                	<div class="ui segments" style="border: none; background: none;">
                        <form class="ui form segment form3 my_login_form" style="background: none;position: relative;z-index: 66">
                            <div  style="border: none; opacity: 0.5;position: absolute;width:100%;height: 100%;background: #fff;top: 0;left: 0;z-index: 50"></div>
                            <img src="img/logo_anydef.png" class="my_logo" style="position: relative;z-index: 55;width: 50%">
                            <div class="field" style="position: relative;z-index: 55">
                                <label><i class="user icon"></i>用户名</label>
                                <input placeholder="请输入用户名" name="user_name" id="u_name" type="text">
                            </div>
                            <div class="field" style="position: relative;z-index: 55">
                                <label><i class="lock icon"></i>密码</label>
                                <input placeholder="请输入密码" name="password" id="u_pass" type="password">
                            </div>
                            <a id="loginbtn" href="javascript:void(0);" style="position: relative;z-index: 55"><div class="ui blue submit button">登录</div></a>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    
    <script src="js/jquery-2.1.4.min.js"></script>
    <script src="plugins/pacejs/pace.js"></script>
	<script src="plugins/lobibox/js/notifications.js"></script>
    <script>
        //var colors = ["#F25F5C", "#247BA0", "#8e44ad", "#ED6A5A", "#32936F", "#2c3e50", "#E83F6F", "#32936F", "#2E294E"];
		var colors = ["#2c3e50"];
        var rand = Math.floor(Math.random() * colors.length);
        $('body').css("background-color", colors[rand]);
		
		var envMessage = '';
		
		if( EnvCheck() == false ) {
			location.href='error.html?tip=' + envMessage;
		}
	
		function EnvCheck() {
			try{
				if(window.Storage && window.localStorage && window.localStorage instanceof Storage){
				}
				else {
					envMessage = '浏览器暂不支持localStorage';
					console.log(envMessage);
					return false;
				}
			} catch (error) {
				envMessage = '浏览器暂不支持localStorage';
				console.log(envMessage);
				return false;
			}

			return true;
		}

        //支持Enter键登录
        document.onkeydown = function(e){
            if(!e) e = window.event;
            if((e.keyCode || e.which) == 13){
                var obtnLogin=document.getElementById("loginbtn");
                obtnLogin.focus();
            }
        };
		
        //sessionStorage.traceFlag = 'login.html';
		
		$(function () {
			
			//, headers: { 'x-requested-with': 'XMLHttpRequest' }
    		$.ajaxSetup({crossDomain: true, xhrFields: {withCredentials: true}});
    
		    $('#loginbtn').on('click.login', function(){
		    	var postdata = {};
		    	postdata.username = $('#u_name').val();
		    	postdata.password = $('#u_pass').val();
				
				$('#loginbtn').addClass('disabled');
				Pace.track(function(){
				$.ajax({
					type: 'POST',
					async: true,
					url: '/ManageServer/login/idpwd',
					//contentType: "application/json;charset=UTF-8",
					//data: JSON.stringify( postdata )
					data: postdata
				})
				.done(function(data){
					if(data.code == 0) {
						location.href='index.html';
					}
					else {
						$('#loginbtn').removeClass('disabled');
						Lobibox.notify('error', {
		                    size: 'normal',
		                    rounded: false,
		                    delayIndicator: true,
		                    msg: data.msg + '[' + data.code + ']',
		                    icon: 'warning icon',
		                    title: '登录失败',
		                    showClass: undefined,
		                    hideClass: undefined,
		                    sound: undefined,
		                    img: undefined,
		                    delay: undefined
						});
					}
				})
				.fail(function(){
					$('#loginbtn').removeClass('disabled');
					Lobibox.notify('error', {
	                    size: 'normal',
	                    rounded: false,
	                    delayIndicator: true,
	                    msg: '访问服务器失败',
	                    icon: 'warning icon',
	                    title: '登录失败',
	                    showClass: undefined,
	                    hideClass: undefined,
	                    sound: undefined,
	                    img: undefined,
	                    delay: undefined
					});
				});
				});
				
				return;
		    });
		    
		});
    </script>
</body>
</html>
